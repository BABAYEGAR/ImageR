@using Image.Models.Entities
@model Package
@{
    Layout = "Layout/Dashboard/_LayoutInvoice";
    ViewBag.PageTitle = "Photo Studio | Invoice";
    UserSubscription subscription = ViewBag.Subscription;
    AppUser appUser = ViewBag.User;
}
<div class="widget-body">
    <div class="row">
        <div class="col-sm-4">
            <address><strong>Twitter, Inc.</strong><br>795 Folsom Ave, Suite 600<br>San Francisco, CA 94107<br><abbr title="Phone">P:</abbr> (123) 456-7890<br><a href="mailto:#">first.last@example.com</a></address>
        </div>
        <div class="col-sm-4">
            <address><strong>Twitter, Inc.</strong><br>795 Folsom Ave, Suite 600<br>San Francisco, CA 94107<br><abbr title="Phone">P:</abbr> (123) 456-7890<br><a href="mailto:#">first.last@example.com</a></address>
        </div>
        <div class="col-sm-4">
            <ul class="list-unstyled">
                <li>Invoice <strong>#900-AHZ</strong></li>
                <li>May 05, 2016</li>
                <li>Account Name: Matthew Gonzalez</li>
                <li><strong>SWIFT code: EACBVNVX</strong></li>
            </ul>
        </div>
    </div>
    <div class="table-responsive">
        <table class="table table-striped">
            <thead>
            <tr>
                <th class="center">#</th>
                <th>Item</th>
                <th>Description</th>
                <th class="center">Quantity</th>
                <th class="right">Unit Cost</th>
                <th class="right">Total</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td class="center">1</td>
                <td class="left">@Model.Name</td>
                <td class="left">@Model.Description</td>
                <td class="center">@subscription.MonthLength/Month</td>
                <td class="right">@Model.Amount</td>
                <td class="right">@Model.Amount * @subscription.MonthLength</td>
            </tr>
            
            </tbody>
        </table>
    </div>
    <div class="row">
        <div class="col-md-4">
            <p>
                Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
                tempor incididunt ut labore et dolore magna aliqua.
            </p>
        </div>
        <div class="col-md-4 col-md-offset-4">
            <table class="table">
                <tbody>
                <tr>
                    <td class="left"><strong>Subtotal</strong></td>
                    <td class="right">$4,897.00</td>
                </tr>
                <tr>
                    <td class="left"><strong>Discount (20%)</strong></td>
                    <td class="right">$783.52</td>
                </tr>
                <tr>
                    <td class="left"><strong>VAT (10%)</strong></td>
                    <td class="right">$489.70</td>
                </tr>
                <tr>
                    <td class="left"><strong>Total</strong></td>
                    <td class="right"><strong>$3,623.78</strong></td>
                </tr>
                </tbody>
            </table>
            <button type="button" class="btn btn-raised btn-primary"><i class="ti-printer"></i> Print</button>
            <button type="button" onclick="payWithPaystack()" class="btn btn-raised btn-success"><i class="ti-credit-card"></i> Proceed to Payment</button>
        </div>
    </div>
</div>
@section Functions
{
    <script>
        function payWithPaystack() {
            var handler = window.PaystackPop.setup({
                key: 'pk_test_d19305d69eba56904f42be1c7a8a1fa0259f0760',
                email: '@appUser.Email',
                amount: @subscription.Amount+"00",
                ref: "",
                metadata: {
                    custom_fields: [
                        {
                            display_name: "Mobile Number",
                            variable_name: "mobile_number",
                            value: "+2348114675635"
                        }
                    ]
                },
                callback: function(response) {
                    ConfirmPayment();
                    alert('success. transaction ref is ' + response.reference);
                    location.href = "@Url.Action("Login", "Account")";
                },
                onClose: function() {
                    alert('window closed');
                }
            });
            handler.openIframe();
        }

        function ConfirmPayment() {
            $.ajax({
                url: '@Url.Action("SubscriptionInvoice", "Account")',
                type: 'POST',
                dataType: 'json',
                // we set cache: false because GET requests are often cached by browsers
                // IE is particularly aggressive in that respect
                cache: false
            });
        }
    </script>  
}
